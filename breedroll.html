<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thilyarem Design Hub - Breeding Roller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.13.10/dist/cdn.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111; color: #e0e0e0; }
        .main-bg { background-image: url('https://f2.toyhou.se/file/f2-toyhou-se/images/104628454_TIW9qLUgkOd23xn.png'); background-size: cover; background-position: center; background-attachment: fixed; }
        .box { background-color: rgba(17, 24, 39, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 0.75rem; }
        .shiny-btn { background: linear-gradient(to bottom, #6d28d9 0%, #4c1d95 100%); border: 1px solid #a78bfa; box-shadow: 0 1px 2px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.15); transition: all 0.3s ease; }
        .shiny-btn:hover { background: linear-gradient(to bottom, #7c3aed 0%, #6d28d9 100%); box-shadow: 0 2px 4px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.25); transform: translateY(-2px); }
        .sidebar { background-color: rgba(10, 10, 12, 0.8); backdrop-filter: blur(10px); }
        .form-input, .form-select { background-color: rgba(30, 41, 59, 0.7); border: 1px solid rgba(71, 85, 105, 1); color: #e0e0e0; border-radius: 0.5rem; padding: 0.65rem; width: 100%; transition: all 0.3s ease; }
        .form-input:focus, .form-select:focus { background-color: rgba(55, 65, 81, 0.8); border-color: #a78bfa; outline: none; box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.4); }
        .form-label { display: block; margin-bottom: 0.5rem; font-size: 0.875rem; font-weight: 500; color: #9ca3af; }
        .tab-btn { background-color: transparent; border-bottom: 2px solid transparent; transition: all 0.3s ease; }
        .tab-btn.active, .tab-btn:hover { color: #c4b5fd; border-bottom-color: #a78bfa; }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="main-bg">

    <div class="flex h-screen">
        <aside id="sidebar" class="sidebar w-64 flex flex-col flex-shrink-0 p-4 transition-all duration-300 ease-in-out">
            <div>
                <h1 class="text-2xl font-bold text-violet-400 mb-6">Design Hub</h1>
                <nav class="space-y-4">
                    <div>
                        <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Core</h2>
                        <a href="#" class="flex items-center p-2 text-gray-300 hover:bg-violet-800/50 rounded-md"><i class="fas fa-home w-6"></i><span>Website</span></a>
                        <a href="#" class="flex items-center p-2 text-gray-300 hover:bg-violet-800/50 rounded-md"><i class="fab fa-discord w-6"></i><span>Official Discord</span></a>
                    </div>
                    <div>
                        <h2 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Breeding Rollers</h2>
                        <div class="space-y-1">
                            <a href="#" class="flex items-center p-2 text-sm text-white bg-violet-800/60 rounded-md"><i class="fas fa-dna w-6"></i> <span>Breeding Roller</span></a>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="mt-auto text-center text-xs text-gray-500">
                <p>Background by <a href="https://www.pexels.com/@belle-co-99483/" target="_blank" class="hover:text-violet-300 underline">Draconic-King</a></p>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-black bg-opacity-60 backdrop-filter backdrop-blur-sm border-b border-gray-800 px-4 sm:px-6 lg:px-8 sticky top-0 z-10">
                <div class="flex items-center justify-between h-20">
                    <div class="flex items-center">
                        <button id="sidebar-toggle" class="text-gray-300 hover:text-white focus:outline-none"><i class="fas fa-bars text-xl"></i></button>
                    </div>
                    <nav class="hidden md:flex items-center space-x-2">
                        <a href="#" class="shiny-btn text-white px-4 py-2 rounded-md text-sm font-medium">Home</a>
                    </nav>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-6">
                <div class="box p-6" x-data="breedingroller" x-init="load()">
                    <h1 class="text-3xl font-bold text-violet-300 mb-6">Breeding Roller</h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        
                        <div class="space-y-4">
                            <h4 class="text-xl font-bold text-violet-400">Parent A</h4>
                            <div>
                                <label for="sire_breed" class="form-label">Breed</label>
                                <select id="sire_breed" x-model="p_a.species" class="form-select">
                                    <template x-for="value in data.breeds"><option :value="value" x-text="value"></option></template>
                                </select>
                            </div>
                            <div>
                                <label for="sire_geno" class="form-label">Genotype</label>
                                <input type="text" id="sire_geno" x-model="p_a.genotype" @change="p_a.phenotype = getPhenotype(p_a.genotype)" class="form-input">
                            </div>
                            <div>
                                <label for="sire_pheno" class="form-label">Phenotype</label>
                                <input type="text" id="sire_pheno" x-model="p_a.phenotype" class="form-input bg-slate-800" readonly>
                            </div>
                            <div class="grid grid-cols-3 gap-4 pt-2">
                                <div class="col-span-2">
                                    <label for="sire_rank" class="form-label">Rank</label>
                                    <select id="sire_rank" x-model="p_a.rank" class="form-select">
                                        <template x-for="value in data.ranks"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                                <div class="col-span-1">
                                    <label for="sire_fertility" class="form-label">Fertility</label>
                                    <select id="sire_fertility" x-model="p_a.fertility" class="form-select">
                                        <template x-for="value in data.fertility"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label for="sire_ability" class="form-label">Ability</label>
                                    <select id="sire_ability" x-model="p_a.ability" class="form-select">
                                        <option value=""></option>
                                        <template x-for="value in data.abilities"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                                <div>
                                    <label for="sire_element" class="form-label">Element</label>
                                    <select id="sire_element" x-model="p_a.element" class="form-select">
                                        <option value=""></option>
                                        <template x-for="value in data.elements"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                                <div>
                                    <label for="sire_aberrant" class="form-label">Aberration</label>
                                    <select id="sire_aberrant" x-model="p_a.aberrant" class="form-select">
                                        <option value=""></option>
                                        <template x-for="value in data.aberrations"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                            </div>
                        </div>
            
                        <div class="space-y-4">
                            <h4 class="text-xl font-bold text-violet-400">Parent B</h4>
                            <div>
                                <label for="dam_breed" class="form-label">Breed</label>
                                <select id="dam_breed" x-model="p_b.species" class="form-select">
                                    <template x-for="value in data.breeds"><option :value="value" x-text="value"></option></template>
                                </select>
                            </div>
                            <div>
                                <label for="dam_geno" class="form-label">Genotype</label>
                                <input type="text" id="dam_geno" x-model="p_b.genotype" @change="p_b.phenotype = getPhenotype(p_b.genotype)" class="form-input">
                            </div>
                            <div>
                                <label for="dam_pheno" class="form-label">Phenotype</label>
                                <input type="text" id="dam_pheno" x-model="p_b.phenotype" class="form-input bg-slate-800" readonly>
                            </div>
                            <div class="grid grid-cols-3 gap-4 pt-2">
                                <div class="col-span-2">
                                    <label for="dam_rank" class="form-label">Rank</label>
                                    <select id="dam_rank" x-model="p_b.rank" class="form-select">
                                        <template x-for="value in data.ranks"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                                <div class="col-span-1">
                                    <label for="dam_fertility" class="form-label">Fertility</label>
                                    <select id="dam_fertility" x-model="p_b.fertility" class="form-select">
                                        <template x-for="value in data.fertility"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label for="dam_ability" class="form-label">Ability</label>
                                    <select id="dam_ability" x-model="p_b.ability" class="form-select">
                                        <option value=""></option>
                                        <template x-for="value in data.abilities"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                                <div>
                                    <label for="dam_element" class="form-label">Element</label>
                                    <select id="dam_element" x-model="p_b.element" class="form-select">
                                        <option value=""></option>
                                        <template x-for="value in data.elements"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                                <div>
                                    <label for="dam_aberrant" class="form-label">Aberration</label>
                                    <select id="dam_aberrant" x-model="p_b.aberrant" class="form-select">
                                        <option value=""></option>
                                        <template x-for="value in data.aberrations"><option :value="value" x-text="value"></option></template>
                                    </select>
                                </div>
                            </div>
                        </div>
            
                        <div class="space-y-4">
                             <h4 class="text-xl font-bold text-violet-400">Items & Inbreeding</h4>
                            <div>
                                <label for="gender_pot" class="form-label">Sex-Determination Potion</label>
                                <select id="gender_pot" x-model="items.gender_pot" class="form-select">
                                    <option value=""></option>
                                    <template x-for="value in data.potions.gender"><option :value="value" x-text="value"></option></template>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <label for="minor_fert" class="form-label mb-0" x-text="data.potions.stacking.MINOR_FERT || 'Minor Fertility Potion'"></label>
                                <input type="number" id="minor_fert" x-model.number="items.minor_fert" @change="validatePotionAllowance" class="form-input w-24" min=0 max=2>
                            </div>
                             <div class="flex items-center justify-between">
                                <label for="major_fert" class="form-label mb-0" x-text="data.potions.stacking.MAJOR_FERT || 'Major Fertility Potion'"></label>
                                <input type="number" id="major_fert" x-model.number="items.major_fert" @change="validatePotionAllowance" class="form-input w-24" min=0 max=2>
                            </div>
                             <div class="flex items-center justify-between">
                                <label for="unstable_elixir" class="form-label mb-0" x-text="data.potions.stacking.UNSTABLE_ELIXIR || 'Unstable Elixir'"></label>
                                <input type="number" id="unstable_elixir" x-model.number="items.unstable_elixir" @change="validatePotionAllowance" class="form-input w-24" min=0 max=3>
                            </div>
                            <small class="text-xs text-gray-500 block pt-0">A maximum of 3 stacking potions can be used.</small>
                            <div class="pt-4">
                                <label for="coi" class="form-label"><abbr title="Coefficient of Inbreeding">COI</abbr></label>
                                <div class="flex">
                                    <input type="number" id="coi" x-model.number="coi" class="form-input rounded-r-none" min="0" max="100" step=".01">
                                    <span class="inline-flex items-center px-3 rounded-r-md bg-slate-700 border border-l-0 border-slate-600 text-gray-300">%</span>
                                </div>
                                <small class="text-xs text-gray-500 mt-1">Calculate with the <a href="#" class="text-violet-400 hover:underline">COI calculator</a>.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 border-t border-gray-700 pt-6">
                        <div class="flex justify-end gap-4">
                            <button @click="reset" class="py-2 px-4 rounded-md text-white font-semibold bg-gray-600 hover:bg-gray-500 transition-colors">Reset Form</button>
                            <button id="rollBreeding" class="shiny-btn text-white font-bold py-2 px-6 rounded-md">Roll Breeding</button>
                        </div>
                        <div class="mt-8" x-data="{ activeTab: 'results' }">
                            <div class="border-b border-gray-700 mb-4">
                                <nav class="flex space-x-4" aria-label="Tabs">
                                    <button @click="activeTab = 'results'" :class="{ 'active': activeTab === 'results' }" class="tab-btn px-3 py-2 font-medium text-sm rounded-t-lg text-gray-300">Results</button>
                                    <button @click="activeTab = 'possibilities'" :class="{ 'active': activeTab === 'possibilities' }" class="tab-btn px-3 py-2 font-medium text-sm rounded-t-lg text-gray-300">Possibilities</button>
                                </nav>
                            </div>
                            <div id="results" x-show="activeTab === 'results'" class="p-4 rounded-lg bg-black/20 min-h-[200px]"><p class="text-gray-400">Breeding results will appear here.</p></div>
                            <div id="possibilities" x-show="activeTab === 'possibilities'" x-cloak class="p-4 rounded-lg bg-black/20"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('breedingroller', () => ({
                p_a: { species: '', genotype: '', phenotype: '', rank: '', fertility: '', ability: '', element: '', aberrant: '' },
                p_b: { species: '', genotype: '', phenotype: '', rank: '', fertility: '', ability: '', element: '', aberrant: '' },
                items: { gender_pot: '', minor_fert: 0, major_fert: 0, unstable_elixir: 0 },
                coi: 0,
                data: { breeds: [], ranks: [], fertility: [], abilities: [], elements: [], aberrations: [], potions: { gender: [], stacking: {} } },
                stats: { clutch: 'N/A', sex: [], markings: [] },
                load() { /* This function will be populated by your breeding-roller.js */ },
                getPhenotype(geno) { return "Phenotype..."; },
                validatePotionAllowance() { /* Potion logic */ },
                reset() { /* Reset logic */ }
            }));
        });
        
        // --- Sidebar toggle script ---
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('w-64');
                sidebar.classList.toggle('w-0');
                sidebar.classList.toggle('p-4');
                sidebar.classList.toggle('p-0');
            });
        }
    </script>
    
    <script src="./js/gene_maps.js"></script>
    <script src="./js/old_genes.js"></script>
    <script src="./js/genotype-helper.js"></script>
    <script src="./js/phenotype-helper.js"></script>
    <script src="./js/punnett-helper.js"></script>
    <script src="./js/clutch_size.js"></script>
    <script src="./js/items.js"></script>
    <script src="./js/item-list.js"></script>
    <script src="./js/genetics-services.js"></script>
    <script src="./js/breed_mix.js"></script>
    <script src="./js/breeding.js"></script>
    <script src="./js/chart_colors.js"></script>
    <script src="./js/breeding-roller.js"></script>

</body>
</html>
