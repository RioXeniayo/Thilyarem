<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Breeding Roller</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .container {
            max-width: 1600px;
        }
        .card {
            margin-bottom: 1.5rem;
        }
        .card-header {
            font-weight: bold;
            font-size: 1.25rem;
        }
        .chimera-section, .inbreed-details {
            display: none;
            border-left: 3px solid #0d6efd;
            padding-left: 1rem;
            margin-top: 1rem;
        }
        #resultsModal .modal-body {
            white-space: pre-wrap;
            font-family: monospace;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        .form-label {
            font-weight: 500;
        }
        hr {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        h2 {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .error-alert {
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Dragon Breeding Roller üêâ</h2>

    <div class="alert alert-danger error-alert" id="error-container" role="alert"></div>

    <!-- Sire and Dam Forms -->
    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header bg-primary text-white">Sire</div>
                <div class="card-body" id="sire-form">
                    <!-- Sire form injected here -->
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header bg-danger text-white">Dam</div>
                <div class="card-body" id="dam-form">
                    <!-- Dam form injected here -->
                </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- Settings and Items -->
    <div class="card">
        <div class="card-header">Breeding Settings & Items</div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <h5>Inbreeding</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="inbred-check">
                        <label class="form-check-label" for="inbred-check">Are the Parents Inbred?</label>
                    </div>
                    <div class="mt-2 inbreed-details">
                        <label for="inbreedingLevel" class="form-label">Inbreeding Level:</label>
                        <select id="inbreedingLevel" class="form-select">
                            <option value="None">None</option>
                            <option value="Slight">Slight</option>
                            <option value="Moderate">Moderate</option>
                            <option value="Severe">Severe</option>
                        </select>
                    </div>
                     <h5 class="mt-3">Bonding</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="bond-breeding-check">
                        <label class="form-check-label" for="bond-breeding-check">Bond Breeding</label>
                    </div>
                </div>

                <div class="col-md-4">
                    <h5>Items</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="fertility-item" id="crescent-herb">
                        <label class="form-check-label" for="crescent-herb">Crescent Herb (Chance at +1 Hatchling)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="fertility-item" id="moonlit-herb">
                        <label class="form-check-label" for="moonlit-herb">Moonlit Herb (Increased mutations, up to +2 cubs)</label>
                    </div>
                    <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" value="" id="calming-brow">
                        <label class="form-check-label" for="calming-brow">Calming Brow (Increased Destrier chance)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="questionable-potion">
                        <label class="form-check-label" for="questionable-potion">Questionable Potion (Chance for random manetype)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="hearty-meal">
                        <label class="form-check-label" for="hearty-meal">Hearty Meal (Healthier cubs for young/inbred parents)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="dubious-food">
                        <label class="form-check-label" for="dubious-food">Dubious Food (Chance for defects)</label>
                    </div>
                </div>

                <div class="col-md-4">
                    <h5>Companions</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="red-panda-companion">
                        <label class="form-check-label" for="red-panda-companion">Red Panda (2% chance for base color modifiers)</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="crane-companion">
                        <label class="form-check-label" for="crane-companion">Crane (2% chance increase of mutations)</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="text-center mt-4">
        <button id="randomize-all-btn" class="btn btn-secondary btn-lg me-2">Randomize Parents</button>
        <button id="roll-btn" class="btn btn-success btn-lg">Roll Breeding!</button>
    </div>

</div> 

<!-- Results Modal -->
<div class="modal fade" id="resultsModal" tabindex="-1" aria-labelledby="resultsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="resultsModalLabel">Breeding Results</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="results-output">
        <!-- Results will be printed here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {

    // --- DATA DEFINITIONS ---
    const SPECIES = ['Cyroa', 'Thilyarem', 'Destrier'];
    const ACTIVE_SPECIES = SPECIES.filter(s => s !== 'Cyroa'); // Disable Cyroa for UI
    const AGES = ['Hatchling', 'Juvenile', 'Adolescent', 'Young Adult', 'Adult', 'Elder', 'Ancient', 'Celestial'];
    const FERTILITY_LEVELS = ['Best', 'Good', 'Okay', 'Bad'];
    const GENOTYPES = {
        'Tan': ["B+/B+ M+/M+ K+/K+", "B+/B+ M+/MB K+/K+", "B+/B+ M+/M0 K+/K+", "B+/B+ MB/MB K+/K+", "B+/B+ MB/M0 K+/K+", "B+/B+ M+/M+ K+/KB", "B+/B+ M+/MB K+/KB", "B+/B+ M+/M0 K+/KB", "B+/B+ MB/MB K+/KB", "B+/B+ MB/M0 K+/KB", "B+/B+ M+/M+ KB/KB", "B+/B+ M+/MB KB/KB", "B+/B+ M+/M0 KB/KB", "B+/B+ MB/MB KB/KB", "B+/B+ MB/M0 KB/KB", "B+/BA M+/M+ K+/K+", "B+/BA M+/MB K+/K+", "B+/BA M+/M0 K+/K+", "B+/BA MB/MB K+/K+", "B+/BA MB/M0 K+/K+", "B+/BA M+/M+ K+/KB", "B+/BA M+/MB K+/KB", "B+/BA M+/M0 K+/KB", "B+/BA MB/MB K+/KB", "B+/BA MB/M0 K+/KB", "B+/BA M+/M+ KB/KB", "B+/BA M+/MB KB/KB", "B+/BA M+/M0 KB/KB", "B+/BA MB/MB KB/KB", "B+/BA MB/M0 KB/KB", "B+/BG M+/M+ K+/K+", "B+/BG M+/MB K+/K+", "B+/BG M+/M0 K+/K+", "B+/BG MB/MB K+/K+", "B+/BG MB/M0 K+/K+", "B+/BG M+/M+ K+/KB", "B+/BG M+/MB K+/KB", "B+/BG M+/M0 K+/KB", "B+/BG MB/MB K+/KB", "B+/BG MB/M0 K+/KB", "B+/BG M+/M+ KB/KB", "B+/BG M+/MB KB/KB", "B+/BG M+/M0 KB/KB", "B+/BG MB/MB KB/KB", "B+/BG MB/M0 KB/KB", "B+/BW M+/M+ K+/K+", "B+/BW M+/MB K+/K+", "B+/BW M+/M0 K+/K+", "B+/BW MB/MB K+/K+", "B+/BW MB/M0 K+/K+", "B+/BW M+/M+ K+/KB", "B+/BW M+/MB K+/KB", "B+/BW M+/M0 K+/KB", "B+/BW MB/MB K+/KB", "B+/BW MB/M0 K+/KB", "B+/BW M+/M+ KB/KB", "B+/BW M+/MB KB/KB", "B+/BW M+/M0 KB/KB", "B+/BW MB/MB KB/KB", "B+/BW MB/M0 KB/KB"],
        'Brown': ["BA/BA M+/M+ K+/K+", "BA/BA M+/MB K+/K+", "BA/BA M+/M0 K+/K+", "BA/BA MB/MB K+/K+", "BA/BA MB/M0 K+/K+", "BA/BA M+/M+ K+/KB", "BA/BA M+/MB K+/KB", "BA/BA M+/M0 K+/KB", "BA/BA MB/MB K+/KB", "BA/BA MB/M0 K+/KB", "BA/BA M+/M+ KB/KB", "BA/BA M+/MB KB/KB", "BA/BA M+/M0 KB/KB", "BA/BA MB/MB KB/KB", "BA/BA MB/M0 KB/KB", "BA/BG M+/M+ K+/K+", "BA/BG M+/MB K+/K+", "BA/BG M+/M0 K+/K+", "BA/BG MB/MB K+/K+", "BA/BG MB/M0 K+/K+", "BA/BG M+/M+ K+/KB", "BA/BG M+/MB K+/KB", "BA/BG M+/M0 K+/KB", "BA/BG MB/MB K+/KB", "BA/BG MB/M0 K+/KB", "BA/BG M+/M+ KB/KB", "BA/BG M+/MB KB/KB", "BA/BG M+/M0 KB/KB", "BA/BG MB/MB KB/KB", "BA/BG MB/M0 KB/KB", "BA/BW M+/M+ K+/K+", "BA/BW M+/MB K+/K+", "BA/BW M+/M0 K+/K+", "BA/BW MB/MB K+/K+", "BA/BW MB/M0 K+/K+", "BA/BW M+/M+ K+/KB", "BA/BW M+/MB K+/KB", "BA/BW M+/M0 K+/KB", "BA/BW MB/MB K+/KB", "BA/BW MB/M0 K+/KB", "BA/BW M+/M+ KB/KB", "BA/BW M+/MB KB/KB", "BA/BW M+/M0 KB/KB", "BA/BW MB/MB KB/KB", "BA/BW MB/M0 KB/KB"],
        'Green': ["BG/BG M+/M+ K+/K+", "BG/BG M+/MB K+/K+", "BG/BG M+/M0 K+/K+", "BG/BG MB/M0 K+/K+", "BG/BG M+/M+ K+/KB", "BG/BG M+/MB K+/KB", "BG/BG M+/M0 K+/KB", "BG/BG MB/M0 K+/KB", "BG/BG M+/M+ KB/KB", "BG/BG M+/MB KB/KB", "BG/BG M+/M0 KB/KB", "BG/BG MB/M0 KB/KB", "BG/BW M+/M+ K+/K+", "BG/BW M+/MB K+/K+", "BG/BW M+/M0 K+/K+", "BG/BW MB/M0 K+/K+", "BG/BW M+/M+ K+/KB", "BG/BW M+/MB K+/KB", "BG/BW M+/M0 K+/KB", "BG/BW MB/M0 K+/KB", "BG/BW M+/M+ KB/KB", "BG/BW M+/MB KB/KB", "BG/BW M+/M0 KB/KB", "BG/BW MB/M0 KB/KB"],
        'White': ["BW/BW M0/M0 K+/K+", "BW/BW M0/M0 K+/KB", "BW/BW M0/M0 KB/KB"],
        'Black': ["B+/B+ M+/M+ KB/KB", "B+/BA M+/M+ KB/KB", "B+/BG M+/M+ KB/KB", "B+/BW M+/M+ KB/KB", "BA/BA M+/M+ KB/KB", "BA/BG M+/M+ KB/KB", "BA/BW M+/M+ KB/KB", "BG/BG M+/M+ KB/KB", "BG/BW M+/M+ KB/KB", "BW/BW M+/M+ KB/KB"],
        'Cream': ["B+/B+ M0/M0 K+/K+", "B+/B+ M0/M0 K+/KB", "B+/B+ M0/M0 KB/KB", "B+/BA M0/M0 K+/K+", "B+/BA M0/M0 K+/KB", "B+/BA M0/M0 KB/KB", "B+/BG M0/M0 K+/K+", "B+/BG M0/M0 K+/KB", "B+/BG M0/M0 KB/KB", "B+/BW M0/M0 K+/K+", "B+/BW M0/M0 K+/KB", "B+/BW M0/M0 KB/KB"],
        'Lilac': ["BA/BA M0/M0 K+/K+", "BA/BA M0/M0 K+/KB", "BA/BA M0/M0 KB/KB", "BA/BG M0/M0 K+/K+", "BA/BG M0/M0 K+/KB", "BA/BG M0/M0 KB/KB", "BA/BW M0/M0 K+/K+", "BA/BW M0/M0 K+/KB", "BA/BW M0/M0 KB/KB"],
        'Seagreen': ["BG/BG MB/MB K+/K+", "BG/BG MB/MB K+/KB", "BG/BG MB/MB KB/KB", "BG/BW MB/MB K+/K+", "BG/BW MB/MB K+/KB", "BG/BW MB/MB KB/KB"],
        'Teagreen': ["BG/BG M0/M0 K+/K+", "BG/BG M0/M0 K+/KB", "BG/BG M0/M0 KB/KB", "BG/BW M0/M0 K+/K+", "BG/BW M0/M0 K+/KB", "BG/BW M0/M0 KB/KB"],
        'Slate': ["BW/BW M+/M+ K+/K+", "BW/BW M+/MB K+/K+", "BW/BW M+/M0 K+/K+", "BW/BW MB/M0 K+/K+", "BW/BW M+/M+ K+/KB", "BW/BW M+/MB K+/KB", "BW/BW M+/M0 K+/KB", "BW/BW MB/M0 K+/KB", "BW/BW M+/M+ KB/KB", "BW/BW M+/MB KB/KB", "BW/BW M+/M0 KB/KB", "BW/BW MB/M0 KB/KB"],
        'Blue': ["BW/BW MB/MB K+/K+", "BW/BW MB/MB K+/KB", "BW/BW MB/MB KB/KB"],
    };
    const MANETYPES = ['Natural', 'Razor', 'Sphinx', 'Curly', 'Long', 'Fiery', 'Barbary'];
    const ELEMENTS = ['Fire', 'Water', 'Air', 'Earth', 'Metal', 'Wood', 'Ice', 'Lightning', 'Light', 'Shadow', 'Aether', 'Verdant', 'Unknown'];
    const BASE_COLORS = Object.keys(GENOTYPES);

    const GENE_LIBRARY = {
        BaseModifiers: { Vl: { name: 'Violet', rarity: 'Rare' }, Vm: { name: 'Vermillion', rarity: 'Rare' }, Jd: { name: 'Jade', rarity: 'Rare' }, Am: { name: 'Amber', rarity: 'Rare' } },
        Markings: { Dpl: { name: 'Dapples', rarity: 'Common' }, Bt: { name: 'Bellytone', rarity: 'Common' }, Mtl: { name: 'Mantle', rarity: 'Common' }, Clr: { name: 'Collar', rarity: 'Common' }, Ikd: { name: 'Inked', rarity: 'Common' }, Sia: { name: 'Siamese', rarity: 'Common' }, Pnt: { name: 'Points', rarity: 'Common' }, Stn: { name: 'Stained', rarity: 'Common' }, Rn: { name: 'Roan', rarity: 'Common' }, Tby: { name: 'Tabby', rarity: 'Common' }, Spt: { name: 'Spotted', rarity: 'Common' }, Apl: { name: 'Appalosa', rarity: 'Uncommon' }, Mrl: { name: 'Merle', rarity: 'Uncommon' }, Brn: { name: 'Barring', rarity: 'Uncommon' }, Dn: { name: 'Dun', rarity: 'Uncommon' }, Pyn: { name: 'Python', rarity: 'Uncommon' }, Stk: { name: 'Streaks', rarity: 'Uncommon' }, Ovr: { name: 'Overo', rarity: 'Uncommon' }, Rsc: { name: 'Rorscach', rarity: 'Uncommon' }, Pg: { name: 'Pangare', rarity: 'Uncommon' }, Sb: { name: 'Sable', rarity: 'Uncommon' }, Pb: { name: 'Piebald', rarity: 'Rare' }, Gnt: { name: 'Glint', rarity: 'Rare' }, Sf: { name: 'Snowfall', rarity: 'Rare' }, Wd: { name: 'Widow', rarity: 'Rare' }, Dmd: { name: 'Diamond', rarity: 'Rare' }, Spr: { name: 'Spider', rarity: 'Rare' }, Stm: { name: 'Spectrum', rarity: 'Rare' }, Iri: { name: 'Iridescent', rarity: 'Rare' } },
        Mutations: { Vit: { name: 'Vitiligo', rarity: 'Common' }, Inv: { name: 'Inversa', rarity: 'Uncommon' }, Les: { name: 'Leucistic', rarity: 'Uncommon' }, Alb: { name: 'Albino', rarity: 'Uncommon' }, Axg: { name: 'Axanthic -G', rarity: 'Uncommon' }, Ery: { name: 'Erythristic', rarity: 'Rare' }, Lva: { name: 'Lavender Albino', rarity: 'Rare' }, Axm: { name: 'Axanthic-M', rarity: 'Rare' } },
        Traits: { Ho: { name: 'Horns', rarity: 'Uncommon' }, Fg: { name: 'Fangs', rarity: 'Uncommon' }, Sp: { name: 'Spines', rarity: 'Rare' } },
        Abilities: { Unbent: { name: 'Unbent'}, Cunning: { name: 'Cunning'}, Strike: { name: 'Strike'}, Bold: { name: 'Bold'}, Swift: { name: 'Swift'}, Skillful_Hunter: { name: 'Skillful Hunter'}, Completionist: { name: 'Completionist'}, Ocean_Champion: { name: 'Ocean Champion'}, Fish_Wrangler: { name: 'Fish Wrangler'}, Charismatic: { name: 'Charismatic'}, Shaman: { name: 'Shaman'}, Foraging_Maestro: { name: 'Foraging Maestro'} }
    };

    const DEFECTS = {
        'Slug Egg': { rarity: 'Uncommon', levels: { Slight: true, Moderate: true, Severe: true } },
        'Stillborn': { rarity: 'Very Rare', levels: { Slight: true, Moderate: true, Severe: true } },
        'Underdeveloped': { rarity: 'Very Rare', levels: { Slight: true, Moderate: true, Severe: true } },
        'Infertile': { rarity: 'Rare', levels: { Slight: true, Moderate: true, Severe: true } },
        'Deafness': { rarity: 'Common', levels: { Slight: false, Moderate: true, Severe: true } },
        'Blindness': { rarity: 'Common', levels: { Slight: false, Moderate: true, Severe: true } },
        'Anosmia': { rarity: 'Uncommon', levels: { Slight: false, Moderate: true, Severe: true } },
        'Malformed Tail': { rarity: 'Rare', levels: { Slight: false, Moderate: true, Severe: true } },
        'Malformed Limbs': { rarity: 'Rare', levels: { Slight: false, Moderate: true, Severe: true } },
        'Lameness': { rarity: 'Uncommon', levels: { Slight: false, Moderate: false, Severe: true } },
        'Hip Dysplasia': { rarity: 'Uncommon', levels: { Slight: false, Moderate: false, Severe: true } },
        'Heart Disease': { rarity: 'Rare', levels: { Slight: false, Moderate: false, Severe: true } },
        'Spinal Defect': { rarity: 'Very Rare', levels: { Slight: false, Moderate: false, Severe: true } },
        'Epilepsy': { rarity: 'Very Rare', levels: { Slight: false, Moderate: false, Severe: true } }
    };
    const RARITY_CHANCES = { 'Common': 0.15, 'Uncommon': 0.08, 'Rare': 0.04, 'Very Rare': 0.01 };

    const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const roll = (chance) => Math.random() < chance;

    function createParentForm(prefix) {
        const abilities = Object.values(GENE_LIBRARY.Abilities).map(t => t.name);
        return `
            <div class="mb-3"><label for="${prefix}-species" class="form-label">Species:</label><select id="${prefix}-species" class="form-select">${ACTIVE_SPECIES.map(s => `<option value="${s}">${s}</option>`).join('')}</select></div>
            <div class="mb-3"><label for="${prefix}-age" class="form-label">Age:</label><select id="${prefix}-age" class="form-select">${AGES.map(a => `<option value="${a}">${a}</option>`).join('')}</select></div>
            <div class="mb-3"><label for="${prefix}-manetype" class="form-label">Manetype:</label><select id="${prefix}-manetype" class="form-select">${MANETYPES.map(m => `<option value="${m}">${m}</option>`).join('')}</select></div>
            <div class="mb-3"><label for="${prefix}-fertility" class="form-label">Fertility:</label><select id="${prefix}-fertility" class="form-select">${FERTILITY_LEVELS.map(f => `<option value="${f}">${f}</option>`).join('')}</select></div>
            <hr>
            <h5>Genetics</h5>
            <div class="row">
                <div class="col-md-6 mb-3"><label for="${prefix}-base-color" class="form-label">Base Color (Phenotype):</label><select id="${prefix}-base-color" class="form-select base-color-selector" data-prefix="${prefix}">${BASE_COLORS.map(c => `<option value="${c}">${c}</option>`).join('')}</select></div>
                <div class="col-md-6 mb-3"><label for="${prefix}-base-genetics" class="form-label">Base Genetics (Genotype):</label><select id="${prefix}-base-genetics" class="form-select"></select></div>
            </div>
            <div class="mb-3"><label for="${prefix}-base-modifier-genetics" class="form-label">Base Modifier Genetics:</label><textarea id="${prefix}-base-modifier-genetics" class="form-control" rows="1" placeholder="e.g., Vl/n Vm/Vm..."></textarea></div>
            <div class="mb-3"><label for="${prefix}-marking-genetics" class="form-label">Marking Genetics:</label><textarea id="${prefix}-marking-genetics" class="form-control" rows="2" placeholder="e.g., Dpl/Dpl Spt/n..."></textarea></div>
            <div class="mb-3"><label for="${prefix}-mutation-genetics" class="form-label">Mutation Genetics:</label><textarea id="${prefix}-mutation-genetics" class="form-control" rows="2" placeholder="e.g., Vit/n..."></textarea></div>
            <div class="mb-3"><label for="${prefix}-trait-genetics" class="form-label">Trait Genetics (Physical):</label><textarea id="${prefix}-trait-genetics" class="form-control" rows="2" placeholder="e.g., Ho/n Fg/Fg..."></textarea></div>
            <div class="form-check mb-3"><input class="form-check-input chimera-check" type="checkbox" id="${prefix}-chimera-check" data-prefix="${prefix}"><label class="form-check-label" for="${prefix}-chimera-check">Chimerism</label></div>
            <div class="chimera-section" id="${prefix}-chimera-section">
                 <h6>Chimera Genetics (Markings & Mutations Only)</h6>
                 <div class="mb-3"><label for="${prefix}-chimera-marking-genetics" class="form-label">Marking Genetics:</label><textarea id="${prefix}-chimera-marking-genetics" class="form-control" rows="2" placeholder="e.g., Dpl/Dpl Spt/n..."></textarea></div>
                 <div class="mb-3"><label for="${prefix}-chimera-mutation-genetics" class="form-label">Mutation Genetics:</label><textarea id="${prefix}-chimera-mutation-genetics" class="form-control" rows="2" placeholder="e.g., Vit/n..."></textarea></div>
            </div><hr>
            <h5>Element & Abilities</h5>
            <div class="mb-3"><label for="${prefix}-element" class="form-label">Inborn Element:</label><select id="${prefix}-element" class="form-select">${ELEMENTS.slice(0,-1).map(e => `<option value="${e}">${e}</option>`).join('')}</select></div>
            <div class="mb-3"><label class="form-label">Abilities:</label><div class="row">${abilities.map(ability => `<div class="col-6 col-sm-4"><div class="form-check"><input class="form-check-input ability-checkbox" type="checkbox" value="${ability}" id="${prefix}-ability-${ability.replace(/ /g, '_')}"><label class="form-check-label" for="${prefix}-ability-${ability.replace(/ /g, '_')}">${ability}</label></div></div>`).join('')}</div></div>
            <div class="mb-3"><label class="form-label">Celestial Abilities:</label><div class="form-check"><input class="form-check-input" type="checkbox" id="${prefix}-divine-blessing"><label class="form-check-label" for="${prefix}-divine-blessing">Divine Blessing</label></div><div class="form-check"><input class="form-check-input" type="checkbox" id="${prefix}-savage-boon"><label class="form-check-label" for="${prefix}-savage-boon">Savage Boon</label></div><div class="form-check"><input class="form-check-input" type="checkbox" id="${prefix}-prismatic-aura"><label class="form-check-label" for="${prefix}-prismatic-aura">Prismatic Aura</label></div></div>`;
    }

    function updateBaseGenetics(prefix) { 
        const color = document.getElementById(`${prefix}-base-color`).value;
        const geneticsDropdown = document.getElementById(`${prefix}-base-genetics`);
        const options = GENOTYPES[color] || [];
        geneticsDropdown.innerHTML = options.map(g => `<option value="${g}">${g}</option>`).join('');
    }
    
    function parseAlleleString(str, library) { 
        const alleleMap = {};
        const parts = str.trim().split(/[\s,]+/);
        parts.forEach(part => {
            if (!part) return;
            let allele1, allele2, key;
            if (part.includes('/')) {
                [allele1, allele2] = part.split('/');
                key = (allele1.toLowerCase() === 'n' ? allele2 : allele1).toUpperCase();
            } else { 
                 allele1 = allele2 = part;
                 key = part.toUpperCase();
            }
            const libraryKey = Object.keys(library).find(k => k.toUpperCase() === key);
            if (libraryKey) {
                alleleMap[libraryKey] = [allele1, allele2];
            }
        });
        return alleleMap;
    }

    function randomizeParent(prefix) { 
        document.getElementById(`${prefix}-species`).value = getRandom(ACTIVE_SPECIES);
        document.getElementById(`${prefix}-age`).value = getRandom(AGES.slice(2)); 
        document.getElementById(`${prefix}-manetype`).value = getRandom(MANETYPES);
        document.getElementById(`${prefix}-fertility`).value = getRandom(FERTILITY_LEVELS);
        document.getElementById(`${prefix}-element`).value = getRandom(ELEMENTS.slice(0, -1));

        const randomColor = getRandom(BASE_COLORS);
        document.getElementById(`${prefix}-base-color`).value = randomColor;
        updateBaseGenetics(prefix);
        const geneticsDropdown = document.getElementById(`${prefix}-base-genetics`);
        if (geneticsDropdown.options.length > 0) {
            geneticsDropdown.selectedIndex = Math.floor(Math.random() * geneticsDropdown.options.length);
        }

        const baseModifierKeys = Object.keys(GENE_LIBRARY.BaseModifiers);
        const markingKeys = Object.keys(GENE_LIBRARY.Markings);
        const mutationKeys = Object.keys(GENE_LIBRARY.Mutations);
        const traitKeys = Object.keys(GENE_LIBRARY.Traits);
        
        let baseModifiersStr = "";
        const numBaseModifiers = Math.floor(Math.random() * 2); // 0 or 1
        for (let i = 0; i < numBaseModifiers; i++) {
            const key = getRandom(baseModifierKeys);
            baseModifiersStr += roll(0.5) ? `${key}/${key} ` : `${key}/n `;
        }

        let markingsStr = "";
        const numMarkings = Math.floor(Math.random() * 5) + 2;
        for (let i = 0; i < numMarkings; i++) {
            const key = getRandom(markingKeys);
            markingsStr += roll(0.5) ? `${key}/${key} ` : `${key}/n `;
        }

        let mutationsStr = "";
        const numMutations = Math.floor(Math.random() * 3);
        for (let i = 0; i < numMutations; i++) {
            const key = getRandom(mutationKeys);
            mutationsStr += roll(0.5) ? `${key}/${key} ` : `${key}/n `;
        }

        let traitsStr = "";
        const numTraits = Math.floor(Math.random() * 3);
        for (let i = 0; i < numTraits; i++) {
            const key = getRandom(traitKeys);
            traitsStr += roll(0.5) ? `${key}/${key} ` : `${key}/n `;
        }
        
        document.getElementById(`${prefix}-base-modifier-genetics`).value = baseModifiersStr.trim();
        document.getElementById(`${prefix}-marking-genetics`).value = markingsStr.trim();
        document.getElementById(`${prefix}-mutation-genetics`).value = mutationsStr.trim();
        document.getElementById(`${prefix}-trait-genetics`).value = traitsStr.trim();
        
        document.querySelectorAll(`#${prefix}-form .ability-checkbox`).forEach(cb => cb.checked = false);
        
        // Handle random chimerism
        const chimeraCheck = document.getElementById(`${prefix}-chimera-check`);
        chimeraCheck.checked = roll(0.05); // 5% chance of being a chimera
        document.getElementById(`${prefix}-chimera-section`).style.display = chimeraCheck.checked ? 'block' : 'none';
        if(chimeraCheck.checked) {
            let chimeraMarkingsStr = "";
            const numChimeraMarkings = Math.floor(Math.random() * 5) + 2;
            for (let i = 0; i < numChimeraMarkings; i++) {
                const key = getRandom(markingKeys);
                chimeraMarkingsStr += roll(0.5) ? `${key}/${key} ` : `${key}/n `;
            }
            document.getElementById(`${prefix}-chimera-marking-genetics`).value = chimeraMarkingsStr.trim();

            let chimeraMutationsStr = "";
            const numChimeraMutations = Math.floor(Math.random() * 3);
             for (let i = 0; i < numChimeraMutations; i++) {
                const key = getRandom(mutationKeys);
                chimeraMutationsStr += roll(0.5) ? `${key}/${key} ` : `${key}/n `;
            }
            document.getElementById(`${prefix}-chimera-mutation-genetics`).value = chimeraMutationsStr.trim();
        }
    }
    
    function rollBreeding() {
        hideError();
        const sire = getParentData('sire');
        const dam = getParentData('dam');
        const settings = getSettings();
        
        if (['Hatchling', 'Juvenile'].includes(sire.age) || ['Hatchling', 'Juvenile'].includes(dam.age)) {
            showError('One or both dragons are too young to breed.');
            return;
        }
        if ((sire.species === 'Cyroa' && dam.species === 'Destrier') || (sire.species === 'Destrier' && dam.species === 'Cyroa')) {
            showError('Invalid Pairing: Destrier and Cyroa cannot breed together.');
            return;
        }

        let minCubs = 1, maxCubs = 5;
        if (sire.age === 'Adolescent' || dam.age === 'Adolescent') { minCubs = 0; maxCubs = 2; }
        else if (sire.age === 'Young Adult') { minCubs = 1; maxCubs = 3; }
        else if (sire.age === 'Elder') { minCubs = 2; maxCubs = 4; }
        else if (sire.age === 'Ancient') { minCubs = 2, maxCubs = 3; }
        else if (sire.age === 'Celestial') { minCubs = 2, maxCubs = 2; }
        
        const fertilityModifiers = { Best: 1.0, Good: 0.85, Okay: 0.6, Bad: 0.3 };
        const avgFertility = (fertilityModifiers[sire.fertility] + fertilityModifiers[dam.fertility]) / 2;
        maxCubs = Math.round(maxCubs * avgFertility);
        if (minCubs > maxCubs) minCubs = maxCubs;
        
        let cubCount = (maxCubs > 0) ? Math.floor(Math.random() * (maxCubs - minCubs + 1)) + minCubs : 0;

        if (settings.crescentHerb && roll(0.52)) cubCount++;
        if (settings.moonlitHerb) {
            cubCount += Math.floor(Math.random() * 3);
            if (roll(0.02)) cubCount++;
        }
        if (settings.bondBreeding) cubCount++;
        
        let outputHTML = cubCount === 0 ? "The breeding resulted in no viable hatchlings." : "";
        let viableHatchlings = 0;

        for (let i = 1; i <= cubCount; i++) {
            const cub = generateCub(sire, dam, settings);
            
            let cubHTML = "";
            if (cub.isChimera) cubHTML += `** Chimeric Markings/Mutations **\n`;
            cubHTML += `Species: ${cub.species.name}\nBuild: ${cub.species.build}\nSex: ${cub.sex}\nManetype: ${cub.manetype}\nElement: ${cub.element}\n`;
            cubHTML += `Base Color: ${cub.baseColor}\nBase Modifiers: ${cub.baseModifiersPheno}\nGenotype: ${cub.genotype}\nPhenotype: ${cub.phenotype}\n`;
            cubHTML += `Carried: ${cub.carried}\n`;
            cubHTML += `Mutations: ${cub.mutations}\nTraits: ${cub.traits}\nAbilities: ${cub.abilities.join(', ') || 'None'}\n`;
            cubHTML += `Fertility: ${cub.fertility}\nInbred: ${cub.inbred}\nDefects: ${cub.defects.length > 0 ? cub.defects.join(', ') : 'Healthy'}\n\n`;

            if (!cub.viable) {
                outputHTML += `================ HATCHLING #${i} (DECEASED) ================\n`;
                outputHTML += `<s>${cubHTML}</s>`;
            } else {
                viableHatchlings++;
                outputHTML += `================ HATCHLING #${viableHatchlings} ================\n`;
                outputHTML += cubHTML;
            }
        }
        showResults(outputHTML);
    }
    
    const inheritGeneCategory = (sireGenes, damGenes, category, settings) => {
        const inherited = [];
        const pheno = [];
        const carried = [];
        const lib = GENE_LIBRARY[category];
        const allGeneKeys = [...new Set([...Object.keys(sireGenes), ...Object.keys(damGenes)])];
        
        allGeneKeys.forEach(key => {
            const geneInfo = lib[key];
            const sireAlleles = sireGenes[key] || ['n', 'n'];
            const damAlleles = damGenes[key] || ['n', 'n'];
            const sireHas = sireAlleles.some(a => a.toLowerCase() !== 'n');
            const damHas = damAlleles.some(a => a.toLowerCase() !== 'n');

            let passChance = 0;
            const basePass = (sireHas && damHas) ? 0.35 : 0.15;
            
            if (geneInfo.rarity === 'Common') passChance = basePass + 0.10;
            else if (geneInfo.rarity === 'Uncommon') passChance = basePass + 0.05;
            else if (geneInfo.rarity === 'Rare') passChance = basePass + 0.02;
            else passChance = basePass;
            
            if (roll(passChance)) {
                const childAlleles = [getRandom(sireAlleles), getRandom(damAlleles)].sort();
                
                if (childAlleles.some(a => a.toLowerCase() !== 'n')) {
                    const isHomozygous = childAlleles[0].toLowerCase() !== 'n' && childAlleles[1].toLowerCase() !== 'n';
                    
                    inherited.push(isHomozygous ? `${key}/${key}` : `${key}/n`);

                    let expressesPhenotypically = false;
                    if (category === 'Markings') {
                        if (geneInfo.rarity === 'Common' || geneInfo.rarity === 'Uncommon') {
                            expressesPhenotypically = true;
                        } else if (geneInfo.rarity === 'Rare' && isHomozygous) {
                            expressesPhenotypically = true;
                        }
                    } else { // Mutations, Traits, and Base Modifiers
                        if (isHomozygous) {
                            expressesPhenotypically = true;
                        }
                    }

                    if (expressesPhenotypically) {
                        pheno.push(geneInfo.name);
                    } else {
                        carried.push(geneInfo.name);
                    }
                }
            }
        });
        return { inherited, pheno, carried };
    };

    function generateCub(sire, dam, settings) {
        const cub = { viable: true, isChimera: false };
        const defectsResult = determineDefects(sire, dam, settings);
        
        cub.defects = defectsResult.defects;
        if (defectsResult.reason) cub.viable = false;
        
        cub.sex = roll(0.5) ? 'Male' : 'Female';
        cub.species = determineSpecies(sire, dam, settings);
        cub.manetype = determineManetype(sire, dam, settings);
        cub.element = roll(0.5) ? sire.element : dam.element;
        cub.abilities = determineAbilities(sire, dam);
        cub.inbred = settings.isInbred ? 'Yes' : 'No';
        cub.fertility = determineOffspringFertility(sire, dam, settings, defectsResult);

        const baseAlleles = {};
        ['B', 'M', 'K'].forEach(locus => {
            const sireL = sire.baseGenetics.split(' ')['BMK'.indexOf(locus)].split('/');
            const damL = dam.baseGenetics.split(' ')['BMK'.indexOf(locus)].split('/');
            baseAlleles[locus] = [getRandom(sireL), getRandom(damL)].sort();
        });
        const baseGeno = `${baseAlleles.B.join('/')} ${baseAlleles.M.join('/')} ${baseAlleles.K.join('/')}`;
        cub.baseColor = determinePhenoColor(baseGeno);
        
        const sireMarkingGenes = sire.isChimera && roll(0.5) ? sire.chimera.markings : sire.primary.markings;
        const damMarkingGenes = dam.isChimera && roll(0.5) ? dam.chimera.markings : dam.primary.markings;
        const sireMutationGenes = sire.isChimera && roll(0.5) ? sire.chimera.mutations : sire.primary.mutations;
        const damMutationGenes = dam.isChimera && roll(0.5) ? dam.chimera.mutations : dam.primary.mutations;

        const primaryBaseModifiers = inheritGeneCategory(sire.primary.baseModifiers, dam.primary.baseModifiers, 'BaseModifiers', settings);
        const primaryMarkings = inheritGeneCategory(sireMarkingGenes, damMarkingGenes, 'Markings', settings);
        const primaryMutations = inheritGeneCategory(sireMutationGenes, damMutationGenes, 'Mutations', settings);
        const primaryTraits = inheritGeneCategory(sire.primary.traits, dam.primary.traits, 'Traits', settings);

        let otherGenes = [...primaryBaseModifiers.inherited, ...primaryMarkings.inherited, ...primaryMutations.inherited, ...primaryTraits.inherited];
        cub.phenotype = primaryMarkings.pheno.join(', ') || 'None';
        cub.baseModifiersPheno = primaryBaseModifiers.pheno.join(', ') || 'None';
        cub.carried = [...primaryBaseModifiers.carried, ...primaryMarkings.carried, ...primaryMutations.carried, ...primaryTraits.carried].join(', ') || 'None';
        cub.mutations = primaryMutations.pheno.join(', ') || 'None';
        cub.traits = primaryTraits.pheno.join(', ') || 'None';

        if (roll(0.01)) {
            cub.isChimera = true;
            if(!cub.defects.includes('Chimerism')) cub.defects.push('Chimerism');
            const secondaryMarkings = inheritGeneCategory(sireMarkingGenes, damMarkingGenes, 'Markings', settings);
            const secondaryMutations = inheritGeneCategory(sireMutationGenes, damMutationGenes, 'Mutations', settings);
            cub.phenotype += ` // ${secondaryMarkings.pheno.join(', ') || 'None'}`;
            cub.mutations += ` // ${secondaryMutations.pheno.join(', ') || 'None'}`;
            otherGenes.push('//', ...secondaryMarkings.inherited, ...secondaryMutations.inherited);
        }

        let mutationChance = 0.015;
        if (settings.moonlitHerb) mutationChance += 0.10;
        if (settings.crane) mutationChance += 0.04;
        if (roll(mutationChance) && !cub.isChimera) {
            const randomMutationKey = getRandom(Object.keys(GENE_LIBRARY.Mutations));
            if (!otherGenes.some(m => m.includes(randomMutationKey))) {
                otherGenes.push(`${randomMutationKey}/n`);
            }
        }
        
        const otherGenesString = otherGenes.join(' ');
        cub.genotype = baseGeno + (otherGenesString ? ` ${otherGenesString}` : '');
        
        return cub;
    }
    
    function determineDefects(sire, dam, settings) {
        const result = { defects: [], isInfertile: false, reason: null };
        let riskModifier = 1.0;
        if (settings.heartyMeal) riskModifier *= 0.5;
        if (settings.dubiousFood) riskModifier *= 2.0;

        let baseRisk = 0;
        if (sire.age === 'Adolescent' || dam.age === 'Adolescent') baseRisk = 0.45;
        if (settings.isInbred) {
            if (settings.inbreedLevel === 'Slight') baseRisk += 0.35;
            else if (settings.inbreedLevel === 'Moderate') baseRisk += 0.65;
            else if (settings.inbreedLevel === 'Severe') baseRisk += 0.95;
        }
        if (settings.dubiousFood) baseRisk += 0.05;

        if (roll(baseRisk)) {
            for (const defect in DEFECTS) {
                const data = DEFECTS[defect];
                const isApplicable = !settings.isInbred || data.levels[settings.inbreedLevel];
                if (isApplicable) {
                    let chance = RARITY_CHANCES[data.rarity] * riskModifier;
                    if (defect === 'Stillborn' && (sire.age === 'Adolescent' || dam.age === 'Adolescent' || settings.inbreedLevel === 'Severe')) {
                        chance *= 3.5; 
                    }
                    if (roll(chance)) {
                         if (defect === 'Stillborn' || defect === 'Slug Egg') {
                             result.reason = defect;
                             return result;
                         }
                         if (defect === 'Infertile') result.isInfertile = true;
                         result.defects.push(defect);
                    }
                }
            }
        }
        return result;
    }

    function determineOffspringFertility(sire, dam, settings, defectsResult) {
        if (settings.inbreedLevel === 'Severe' && roll(0.15)) return 'Sterile';
        if (defectsResult.isInfertile) return 'Bad';

        const fertilityMap = { Best: 4, Good: 3, Okay: 2, Bad: 1 };
        let fertilityScore = Math.round((fertilityMap[sire.fertility] + fertilityMap[dam.fertility]) / 2);

        if (sire.age === 'Adolescent' || dam.age === 'Adolescent') fertilityScore--;
        if (settings.inbreedLevel === 'Moderate' || settings.inbreedLevel === 'Severe') fertilityScore--;
        if (fertilityScore < 1) fertilityScore = 1;

        return Object.keys(fertilityMap).find(key => fertilityMap[key] === fertilityScore) || 'Bad';
    }

    function determineManetype(sire, dam, settings) {
        if (settings.questionablePotion && roll(0.27)) return getRandom(MANETYPES);

        const sireMane = sire.manetype;
        const damMane = dam.manetype;

        if (sireMane === 'Natural' && damMane === 'Natural') {
            if (roll(0.95)) return 'Natural';
            return 'Razor';
        }

        if (sireMane === damMane) {
            if (roll(0.80)) return sireMane;
            if (roll(0.15)) return 'Natural';
            return getRandom(MANETYPES.filter(m => m !== sireMane));
        } else {
            if (roll(0.70)) return 'Natural';
            if (roll(0.50)) return sireMane; 
            return damMane;
        }
    }

    function determinePhenoColor(geno) {
        const whiteGenotypes = ["BW/BW M0/M0 K+/K+", "BW/BW M0/M0 K+/KB", "BW/BW M0/M0 KB/KB"];
        if (whiteGenotypes.includes(geno)) {
            return "White";
        }
        for (const color in GENOTYPES) { 
            if (GENOTYPES[color].includes(geno)) return color; 
        } 
        return "Unknown";
    }

    function determineSpecies(sire, dam, settings) { 
        const s = sire.species; const d = dam.species;
        let build = 'Thilyarem'; 
        if (s === 'Destrier' || d === 'Destrier') {
            let destrierChance = 0;
            if (s === 'Destrier' && d === 'Destrier') destrierChance = 0.40;
            else if (s === 'Destrier' || d === 'Destrier') destrierChance = 0.15;
            if (settings.calmingBrow) destrierChance += 0.12;
            if (sire.savageBoon || dam.savageBoon) destrierChance += 0.05;
            if (roll(destrierChance)) { build = 'Destrier'; }
        }
        if (build === 'Destrier') return { name: 'Panlongus Lykophus Imperator', build: 'Destrier' };
        return { name: 'Panlongus lykophus pelagius', build: 'Thilyarem' };
    }
    
    function determineAbilities(sire, dam) { 
        const inheritedAbilities = [];
        Object.keys(GENE_LIBRARY.Abilities).forEach(key => {
            const abilityName = GENE_LIBRARY.Abilities[key].name;
            const sireHas = sire.abilities.includes(abilityName);
            const damHas = dam.abilities.includes(abilityName);
            let passChance = 0;
            if (sireHas && damHas) passChance = 0.20;
            else if (sireHas || damHas) passChance = 0.08;
            if(roll(passChance)) inheritedAbilities.push(abilityName);
        });
        return inheritedAbilities;
    }

    function getParentData(prefix) { 
        const isChimera = document.getElementById(`${prefix}-chimera-check`).checked;
        const data = {
            isChimera: isChimera,
            primary: {},
            chimera: {}
        };

        data.species = document.getElementById(`${prefix}-species`).value;
        data.age = document.getElementById(`${prefix}-age`).value;
        data.manetype = document.getElementById(`${prefix}-manetype`).value;
        data.fertility = document.getElementById(`${prefix}-fertility`).value;
        data.element = document.getElementById(`${prefix}-element`).value;
        data.savageBoon = document.getElementById(`${prefix}-savage-boon`).checked;
        data.abilities = Array.from(document.querySelectorAll(`#${prefix}-form .ability-checkbox:checked`)).map(cb => cb.value);
        
        data.primary.baseGenetics = document.getElementById(`${prefix}-base-genetics`).value;
        data.primary.baseModifiers = parseAlleleString(document.getElementById(`${prefix}-base-modifier-genetics`).value, GENE_LIBRARY.BaseModifiers);
        data.primary.markings = parseAlleleString(document.getElementById(`${prefix}-marking-genetics`).value, GENE_LIBRARY.Markings);
        data.primary.mutations = parseAlleleString(document.getElementById(`${prefix}-mutation-genetics`).value, GENE_LIBRARY.Mutations);
        data.primary.traits = parseAlleleString(document.getElementById(`${prefix}-trait-genetics`).value, GENE_LIBRARY.Traits);

        if(isChimera) {
            data.chimera.markings = parseAlleleString(document.getElementById(`${prefix}-chimera-marking-genetics`).value, GENE_LIBRARY.Markings);
            data.chimera.mutations = parseAlleleString(document.getElementById(`${prefix}-chimera-mutation-genetics`).value, GENE_LIBRARY.Mutations);
        }

        return data;
    }

    function getSettings() { 
        return {
            isInbred: document.getElementById('inbred-check').checked,
            inbreedLevel: document.getElementById('inbreedingLevel').value,
            crescentHerb: document.getElementById('crescent-herb').checked,
            moonlitHerb: document.getElementById('moonlit-herb').checked,
            calmingBrow: document.getElementById('calming-brow').checked,
            questionablePotion: document.getElementById('questionable-potion').checked,
            dubiousFood: document.getElementById('dubious-food').checked,
            heartyMeal: document.getElementById('hearty-meal').checked,
            bondBreeding: document.getElementById('bond-breeding-check').checked,
            crane: document.getElementById('crane-companion').checked,
        };
    }

    function showError(message) { 
        const errorDiv = document.getElementById('error-container');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
    }

    function hideError() { 
        document.getElementById('error-container').style.display = 'none';
    }
    
    function showResults(outputHTML) { 
        document.getElementById('results-output').innerHTML = outputHTML;
        const resultsModal = new bootstrap.Modal(document.getElementById('resultsModal'));
        resultsModal.show();
    }
    
    function init() {
        document.getElementById('sire-form').innerHTML = createParentForm('sire');
        document.getElementById('dam-form').innerHTML = createParentForm('dam');
        randomizeParent('sire');
        randomizeParent('dam');
        document.getElementById('roll-btn').addEventListener('click', rollBreeding);
        document.getElementById('randomize-all-btn').addEventListener('click', () => {
            randomizeParent('sire');
            randomizeParent('dam');
        });
        document.querySelectorAll('.base-color-selector').forEach(sel => {
            sel.addEventListener('change', (e) => updateBaseGenetics(e.target.dataset.prefix));
            updateBaseGenetics(sel.dataset.prefix);
        });
        document.querySelectorAll('.chimera-check').forEach(chk => {
            chk.addEventListener('change', (e) => {
                const prefix = e.target.dataset.prefix;
                document.getElementById(`${prefix}-chimera-section`).style.display = e.target.checked ? 'block' : 'none';
            });
        });
        document.getElementById('inbred-check').addEventListener('change', (e) => {
            document.querySelector('.inbreed-details').style.display = e.target.checked ? 'block' : 'none';
        });
    }

    init();
});
</script>

</body>
</html>
