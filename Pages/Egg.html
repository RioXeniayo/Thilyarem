<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Egg Generator</title>
    <!-- Bootstrap CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        .container {
            max-width: 800px;
        }
        .card {
            margin-bottom: 1.5rem;
        }
        #results-output {
            white-space: pre-wrap;
            font-family: monospace;
            background-color: #e9ecef;
            border-radius: .375rem;
            padding: 1rem;
            min-height: 300px;
        }
        h1 {
            text-align: center;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Dragon Egg Generator ðŸ¥š</h1>

    <div class="card">
        <div class="card-body">
            <div class="row align-items-end">
                <div class="col-md-8">
                    <label for="egg-type-select" class="form-label">Select Egg Type:</label>
                    <select class="form-select" id="egg-type-select">
                        <option value="Newbie" selected>Newbie</option>
                        <option value="Common">Common</option>
                        <option value="Uncommon">Uncommon</option>
                        <option value="Rare">Rare</option>
                        <option value="Destrier">Destrier</option>
                        <option value="Mystery">Mystery</option>
                    </select>
                </div>
                <div class="col-md-4 mt-3 mt-md-0">
                    <button id="generate-btn" class="btn btn-primary w-100">Generate Egg</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            Generated Dragon
        </div>
        <div class="card-body">
            <div id="results-output">Select an egg type and click "Generate Egg" to see the results.</div>
        </div>
    </div>

</div> <!-- /container -->

<!-- Main Application JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {

    // --- DATA DEFINITIONS ---
    const GENOTYPES = {
        'Tan': ["B+/B+ M+/M+ K+/K+", "B+/B+ M+/MB K+/K+", "B+/B+ M+/M0 K+/K+", "B+/B+ MB/MB K+/K+", "B+/B+ MB/M0 K+/K+", "B+/B+ M+/M+ K+/KB", "B+/B+ M+/MB K+/KB", "B+/B+ M+/M0 K+/KB", "B+/B+ MB/MB K+/KB", "B+/B+ MB/M0 K+/KB", "B+/B+ M+/M+ KB/KB", "B+/B+ M+/MB KB/KB", "B+/B+ M+/M0 KB/KB", "B+/B+ MB/MB KB/KB", "B+/B+ MB/M0 KB/KB", "B+/BA M+/M+ K+/K+", "B+/BA M+/MB K+/K+", "B+/BA M+/M0 K+/K+", "B+/BA MB/MB K+/K+", "B+/BA MB/M0 K+/K+", "B+/BA M+/M+ K+/KB", "B+/BA M+/MB K+/KB", "B+/BA M+/M0 K+/KB", "B+/BA MB/MB K+/KB", "B+/BA MB/M0 K+/KB", "B+/BA M+/M+ KB/KB", "B+/BA M+/MB KB/KB", "B+/BA M+/M0 KB/KB", "B+/BA MB/MB KB/KB", "B+/BA MB/M0 KB/KB", "B+/BG M+/M+ K+/K+", "B+/BG M+/MB K+/K+", "B+/BG M+/M0 K+/K+", "B+/BG MB/MB K+/K+", "B+/BG MB/M0 K+/K+", "B+/BG M+/M+ K+/KB", "B+/BG M+/MB K+/KB", "B+/BG M+/M0 K+/KB", "B+/BG MB/MB K+/KB", "B+/BG MB/M0 K+/KB", "B+/BG M+/M+ KB/KB", "B+/BG M+/MB KB/KB", "B+/BG M+/M0 KB/KB", "B+/BG MB/MB KB/KB", "B+/BG MB/M0 KB/KB", "B+/BW M+/M+ K+/K+", "B+/BW M+/MB K+/K+", "B+/BW M+/M0 K+/K+", "B+/BW MB/MB K+/K+", "B+/BW MB/M0 K+/K+", "B+/BW M+/M+ K+/KB", "B+/BW M+/MB K+/KB", "B+/BW M+/M0 K+/KB", "B+/BW MB/MB K+/KB", "B+/BW MB/M0 K+/KB", "B+/BW M+/M+ KB/KB", "B+/BW M+/MB KB/KB", "B+/BW M+/M0 KB/KB", "B+/BW MB/MB KB/KB", "B+/BW MB/M0 KB/KB"],
        'Brown': ["BA/BA M+/M+ K+/K+", "BA/BA M+/MB K+/K+", "BA/BA M+/M0 K+/K+", "BA/BA MB/MB K+/K+", "BA/BA MB/M0 K+/K+", "BA/BA M+/M+ K+/KB", "BA/BA M+/MB K+/KB", "BA/BA M+/M0 K+/KB", "BA/BA MB/MB K+/KB", "BA/BA MB/M0 K+/KB", "BA/BA M+/M+ KB/KB", "BA/BA M+/MB KB/KB", "BA/BA M+/M0 KB/KB", "BA/BA MB/MB KB/KB", "BA/BA MB/M0 KB/KB", "BA/BG M+/M+ K+/K+", "BA/BG M+/MB K+/K+", "BA/BG M+/M0 K+/K+", "BA/BG MB/MB K+/K+", "BA/BG MB/M0 K+/K+", "BA/BG M+/M+ K+/KB", "BA/BG M+/MB K+/KB", "BA/BG M+/M0 K+/KB", "BA/BG MB/MB K+/KB", "BA/BG MB/M0 K+/KB", "BA/BG M+/M+ KB/KB", "BA/BG M+/MB KB/KB", "BA/BG M+/M0 KB/KB", "BA/BG MB/MB KB/KB", "BA/BG MB/M0 KB/KB", "BA/BW M+/M+ K+/K+", "BA/BW M+/MB K+/K+", "BA/BW M+/M0 K+/K+", "BA/BW MB/MB K+/K+", "BA/BW MB/M0 K+/K+", "BA/BW M+/M+ K+/KB", "BA/BW M+/MB K+/KB", "BA/BW M+/M0 K+/KB", "BA/BW MB/MB K+/KB", "BA/BW MB/M0 K+/KB", "BA/BW M+/M+ KB/KB", "BA/BW M+/MB KB/KB", "BA/BW M+/M0 KB/KB", "BA/BW MB/MB KB/KB", "BA/BW MB/M0 KB/KB"],
        'Green': ["BG/BG M+/M+ K+/K+", "BG/BG M+/MB K+/K+", "BG/BG M+/M0 K+/K+", "BG/BG MB/M0 K+/K+", "BG/BG M+/M+ K+/KB", "BG/BG M+/MB K+/KB", "BG/BG M+/M0 K+/KB", "BG/BG MB/M0 K+/KB", "BG/BG M+/M+ KB/KB", "BG/BG M+/MB KB/KB", "BG/BG M+/M0 KB/KB", "BG/BG MB/M0 KB/KB", "BG/BW M+/M+ K+/K+", "BG/BW M+/MB K+/K+", "BG/BW M+/M0 K+/K+", "BG/BW MB/M0 K+/K+", "BG/BW M+/M+ K+/KB", "BG/BW M+/MB K+/KB", "BG/BW M+/M0 K+/KB", "BG/BW MB/M0 K+/KB", "BG/BW M+/M+ KB/KB", "BG/BW M+/MB KB/KB", "BG/BW M+/M0 KB/KB", "BG/BW MB/M0 KB/KB"],
        'White': ["BW/BW M0/M0 K+/K+", "BW/BW M0/M0 K+/KB", "BW/BW M0/M0 KB/KB"],
        'Black': ["B+/B+ M+/M+ KB/KB", "B+/BA M+/M+ KB/KB", "B+/BG M+/M+ KB/KB", "B+/BW M+/M+ KB/KB", "BA/BA M+/M+ KB/KB", "BA/BG M+/M+ KB/KB", "BA/BW M+/M+ KB/KB", "BG/BG M+/M+ KB/KB", "BG/BW M+/M+ KB/KB", "BW/BW M+/M+ KB/KB"],
        'Cream': ["B+/B+ M0/M0 K+/K+", "B+/B+ M0/M0 K+/KB", "B+/B+ M0/M0 KB/KB", "B+/BA M0/M0 K+/K+", "B+/BA M0/M0 K+/KB", "B+/BA M0/M0 KB/KB", "B+/BG M0/M0 K+/K+", "B+/BG M0/M0 K+/KB", "B+/BG M0/M0 KB/KB", "B+/BW M0/M0 K+/K+", "B+/BW M0/M0 K+/KB", "B+/BW M0/M0 KB/KB"],
        'Lilac': ["BA/BA M0/M0 K+/K+", "BA/BA M0/M0 K+/KB", "BA/BA M0/M0 KB/KB", "BA/BG M0/M0 K+/K+", "BA/BG M0/M0 K+/KB", "BA/BG M0/M0 KB/KB", "BA/BW M0/M0 K+/K+", "BA/BW M0/M0 K+/KB", "BA/BW M0/M0 KB/KB"],
        'Seagreen': ["BG/BG MB/MB K+/K+", "BG/BG MB/MB K+/KB", "BG/BG MB/MB KB/KB", "BG/BW MB/MB K+/K+", "BG/BW MB/MB K+/KB", "BG/BW MB/MB KB/KB"],
        'Teagreen': ["BG/BG M0/M0 K+/K+", "BG/BG M0/M0 K+/KB", "BG/BG M0/M0 KB/KB", "BG/BW M0/M0 K+/K+", "BG/BW M0/M0 K+/KB", "BG/BW M0/M0 KB/KB"],
        'Slate': ["BW/BW M+/M+ K+/K+", "BW/BW M+/MB K+/K+", "BW/BW M+/M0 K+/K+", "BW/BW MB/M0 K+/K+", "BW/BW M+/M+ K+/KB", "BW/BW M+/MB K+/KB", "BW/BW M+/M0 K+/KB", "BW/BW MB/M0 K+/KB", "BW/BW M+/M+ KB/KB", "BW/BW M+/MB KB/KB", "BW/BW M+/M0 KB/KB", "BW/BW MB/M0 KB/KB"],
        'Blue': ["BW/BW MB/MB K+/K+", "BW/BW MB/MB K+/KB", "BW/BW MB/MB KB/KB"],
    };
    const GENE_LIBRARY = {
        BaseModifiers: { Vl: { name: 'Violet', rarity: 'Rare' }, Vm: { name: 'Vermillion', rarity: 'Rare' }, Jd: { name: 'Jade', rarity: 'Rare' }, Am: { name: 'Amber', rarity: 'Rare' }, Prl: { name: 'Pearl', rarity: 'Rare' } },
        Markings: { Dpl: { name: 'Dapples', rarity: 'Common' }, Bt: { name: 'Bellytone', rarity: 'Common' }, Mtl: { name: 'Mantle', rarity: 'Common' }, Clr: { name: 'Collar', rarity: 'Common' }, Ikd: { name: 'Inked', rarity: 'Common' }, Sia: { name: 'Siamese', rarity: 'Common' }, Pnt: { name: 'Points', rarity: 'Common' }, Stn: { name: 'Stained', rarity: 'Common' }, Rn: { name: 'Roan', rarity: 'Common' }, Tby: { name: 'Tabby', rarity: 'Common' }, Spt: { name: 'Spotted', rarity: 'Common' }, Apl: { name: 'Appalosa', rarity: 'Uncommon' }, Mrl: { name: 'Merle', rarity: 'Uncommon' }, Brn: { name: 'Barring', rarity: 'Uncommon' }, Dn: { name: 'Dun', rarity: 'Uncommon' }, Pyn: { name: 'Python', rarity: 'Uncommon' }, Stk: { name: 'Streaks', rarity: 'Uncommon' }, Ovr: { name: 'Overo', rarity: 'Uncommon' }, Rsc: { name: 'Rorscach', rarity: 'Uncommon' }, Pg: { name: 'Pangare', rarity: 'Uncommon' }, Sb: { name: 'Sable', rarity: 'Uncommon' }, Pb: { name: 'Piebald', rarity: 'Rare' }, Gnt: { name: 'Glint', rarity: 'Rare' }, Sf: { name: 'Snowfall', rarity: 'Rare' }, Wd: { name: 'Widow', rarity: 'Rare' }, Dmd: { name: 'Diamond', rarity: 'Rare' }, Spr: { name: 'Spider', rarity: 'Rare' }, Stm: { name: 'Spectrum', rarity: 'Rare' }, Iri: { name: 'Iridescent', rarity: 'Rare' } },
        Mutations: { Vit: { name: 'Vitiligo', rarity: 'Common' }, Inv: { name: 'Inversa', rarity: 'Uncommon' }, Les: { name: 'Leucistic', rarity: 'Uncommon' }, Alb: { name: 'Albino', rarity: 'Uncommon' }, Axg: { name: 'Axanthic -G', rarity: 'Uncommon' }, Ery: { name: 'Erythristic', rarity: 'Rare' }, Lva: { name: 'Lavender Albino', rarity: 'Rare' }, Axm: { name: 'Axanthic-M', rarity: 'Rare' } },
        Traits: { Ho: { name: 'Horns', rarity: 'Uncommon' }, Fg: { name: 'Fangs', rarity: 'Uncommon' }, Sp: { name: 'Spines', rarity: 'Rare' } },
    };

    const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const roll = (chance) => Math.random() < chance;

    const resultsOutput = document.getElementById('results-output');
    const generateBtn = document.getElementById('generate-btn');
    const eggTypeSelect = document.getElementById('egg-type-select');

    const sortedGenes = { BaseModifiers: {}, Markings: {}, Mutations: {}, Traits: {} };
    for (const category in sortedGenes) {
        sortedGenes[category]['Common'] = [];
        sortedGenes[category]['Uncommon'] = [];
        sortedGenes[category]['Rare'] = [];
        for (const allele in GENE_LIBRARY[category]) {
            const gene = GENE_LIBRARY[category][allele];
            sortedGenes[category][gene.rarity].push(allele);
        }
    }

    function generateDragon(eggType) {
        const dragon = {};
        const tier = (eggType === 'Destrier') ? 'Common' : eggType;

        // 1. Determine Species
        let build = 'Thilyarem';
        if (eggType === 'Destrier') build = 'Destrier';
        else if (eggType === 'Mystery') build = getRandom(['Thilyarem', 'Destrier']);
        
        if (build === 'Destrier') dragon.species = { name: 'Panlongus Lykophus Imperator', build: 'Destrier' };
        else dragon.species = { name: 'Panlongus lykophus pelagius', build: 'Thilyarem' };

        // 2. Determine Mane
        const manePools = {
            Newbie: ['Natural', 'Razor'],
            Common: ['Natural', 'Natural', 'Natural', 'Razor'],
            Uncommon: ['Natural', 'Natural', 'Razor', 'Sphinx', 'Curly'],
            Rare: ['Sphinx', 'Curly', 'Long', 'Fiery', 'Barbary'],
            Destrier: ['Natural'],
            Mystery: ['Natural', 'Razor', 'Sphinx', 'Curly', 'Long', 'Fiery', 'Barbary']
        };
        dragon.manetype = getRandom(manePools[eggType]);

        // 3. Determine Base Color
        const colorPools = {
            Newbie: ['Tan', 'Cream', 'Brown'],
            Common: ['Tan', 'Cream', 'Brown', 'Lilac'],
            Uncommon: ['Brown', 'Lilac', 'Green', 'Seagreen', 'Teagreen'],
            Rare: Object.keys(GENOTYPES),
            Mystery: Object.keys(GENOTYPES)
        };
        const chosenColor = getRandom(colorPools[tier]);
        dragon.baseColor = chosenColor;
        dragon.baseGeno = getRandom(GENOTYPES[chosenColor]);

        // 4. Determine Genes
        const { geno: otherGeno, pheno, carried } = getRandomGenes(tier);
        dragon.genotype = `${dragon.baseGeno} ${otherGeno.join(' ')}`.trim();
        dragon.phenotype = pheno.Markings.join(', ') || 'None';
        dragon.baseModifiers = pheno.BaseModifiers.join(', ') || 'None';
        dragon.mutations = pheno.Mutations.join(', ') || 'None';
        dragon.traits = pheno.Traits.join(', ') || 'None';
        dragon.carried = [...carried.BaseModifiers, ...carried.Markings, ...carried.Mutations, ...carried.Traits].join(', ') || 'None';

        // 5. Final Formatting
        let output = `Species: ${dragon.species.name}\n`;
        output += `Build: ${dragon.species.build}\n`;
        output += `Age: Hatchling\n`;
        output += `Sex: ${roll(0.5) ? 'Male' : 'Female'}\n`;
        output += `Manetype: ${dragon.manetype}\n`;
        output += `Base Color: ${dragon.baseColor}\n`;
        output += `Base Modifiers: ${dragon.baseModifiers}\n`;
        output += `Genotype: ${dragon.genotype}\n`;
        output += `Phenotype: ${dragon.phenotype}\n`;
        output += `Carried: ${dragon.carried}\n`;
        output += `Mutations: ${dragon.mutations}\n`;
        output += `Traits: ${dragon.traits}\n`;
        output += `Fertility: Best\n`;
        output += `Defects: Healthy\n`;

        resultsOutput.textContent = output;
    }

    function getRandomGenes(tier) {
        const geno = [];
        const pheno = { BaseModifiers: [], Markings: [], Mutations: [], Traits: [] };
        const carried = { BaseModifiers: [], Markings: [], Mutations: [], Traits: [] };
        
        let markingPool = [];
        if (tier === 'Newbie') {
            markingPool = [...sortedGenes.Markings.Common, ...sortedGenes.Markings.Uncommon];
        } else {
            markingPool = [...sortedGenes.Markings.Common, ...sortedGenes.Markings.Uncommon, ...sortedGenes.Markings.Rare];
        }

        for (let i = 0; i < 3; i++) {
            addGene(getRandom(markingPool), 'Markings', geno, pheno, carried);
        }
        
        if (tier !== 'Newbie') {
            if (roll(0.4)) addGene(getWeightedRandomGene('Markings'), 'Markings', geno, pheno, carried);
            if (roll(0.2)) addGene(getWeightedRandomGene('Markings'), 'Markings', geno, pheno, carried);
        }
        
        if (tier === 'Uncommon' && roll(0.25)) {
            const pool = [...sortedGenes.Mutations.Common, ...sortedGenes.Mutations.Uncommon];
            addGene(getRandom(pool), 'Mutations', geno, pheno, carried);
        } else if (tier === 'Rare' && roll(0.5)) {
            addGene(getWeightedRandomGene('Mutations'), 'Mutations', geno, pheno, carried);
        } else if (tier === 'Mystery' && roll(0.2)) {
            const pool = [...sortedGenes.Mutations.Common, ...sortedGenes.Mutations.Uncommon, ...sortedGenes.Mutations.Rare];
            addGene(getRandom(pool), 'Mutations', geno, pheno, carried);
        }

        if ((tier === 'Common' || tier === 'Newbie') && roll(0.15)) {
            addGene(getRandom(sortedGenes.Traits.Uncommon), 'Traits', geno, pheno, carried);
        } else if (tier === 'Uncommon' && roll(0.4)) {
            const pool = [...sortedGenes.Traits.Uncommon, ...sortedGenes.Traits.Rare];
            addGene(getRandom(pool), 'Traits', geno, pheno, carried);
        } else if (tier === 'Rare' && roll(0.75)) {
            addGene(getWeightedRandomGene('Traits'), 'Traits', geno, pheno, carried);
        } else if (tier === 'Mystery' && roll(0.25)) {
            const pool = [...sortedGenes.Traits.Uncommon, ...sortedGenes.Traits.Rare];
            addGene(getRandom(pool), 'Traits', geno, pheno, carried);
        }

        return { geno, pheno, carried };
    }

    function addGene(allele, category, geno, pheno, carried) {
        if (!allele || geno.some(g => g.toUpperCase().includes(allele.toUpperCase()))) return;

        const geneInfo = GENE_LIBRARY[category][allele];
        const isHomozygous = roll(0.5);
        
        geno.push(isHomozygous ? `${allele}/${allele}` : `${allele}/n`);

        let expressesPhenotypically = false;
        if (category === 'Markings') {
            if (geneInfo.rarity === 'Common' || geneInfo.rarity === 'Uncommon') {
                expressesPhenotypically = true;
            } else if (geneInfo.rarity === 'Rare' && isHomozygous) {
                expressesPhenotypically = true;
            }
        } else { // Mutations, Traits, and Base Modifiers
            if (isHomozygous) {
                expressesPhenotypically = true;
            }
        }

        if (expressesPhenotypically) {
            pheno[category].push(geneInfo.name);
        } else {
            carried[category].push(geneInfo.name);
        }
    }

    function getWeightedRandomGene(category) {
        const rand = Math.random();
        if (rand < 0.5 && sortedGenes[category].Uncommon.length > 0) {
            return getRandom(sortedGenes[category].Uncommon);
        } else if (sortedGenes[category].Rare.length > 0) {
            return getRandom(sortedGenes[category].Rare);
        }
        return getRandom(sortedGenes[category].Uncommon) || getRandom(sortedGenes[category].Common);
    }

    generateBtn.addEventListener('click', () => {
        const selectedType = eggTypeSelect.value;
        generateDragon(selectedType);
    });

    generateDragon(eggTypeSelect.value);
});
</script>

</body>
</html>
